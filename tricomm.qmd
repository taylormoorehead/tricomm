---
title: "tricomm_project"
format: html
editor: visual
---

## Introduction

```{r}
library(tidyverse)
library(tidymodels)
library(readr)
library(dplyr)
library(ggplot2)

```

```{r}
census_table01 <- read_csv("~/tricomm/table01.csv", show_col_types = FALSE) 
census_table11 <- read_csv("~/tricomm/table11.csv", show_col_types = FALSE) 
census_table08 <- read_csv("~/tricomm/table08.csv", show_col_types = FALSE) 
census_table04 <- read_csv("~/tricomm/table04.csv", show_col_types = FALSE) 




census_table01 <- census_table01 |>
  select(GEOID, B01001_002E, B01001_026E)

census_table11 <- census_table11 |>
  select(GEOID, B23022_002E, B23022_026E)

census_table08 <- census_table08 |>
  select(GEOID, B17001_003E, B17001_017E)

census_table04 <- census_table04 |>
  select(GEOID, B27001_004E, B27001_005E, B27001_007E, B27001_008E, B27001_010E, B27001_011E, B27001_013E, 
B27001_014E, B27001_016E, B27001_017E, B27001_019E, B27001_020E, B27001_022E, B27001_023E, B27001_025E, B27001_026E, B27001_028E, B27001_029E, B27001_032E, B27001_033E, B27001_035E, B27001_036E, B27001_038E, B27001_039E, B27001_041E, B27001_042E, B27001_044E, B27001_045E, B27001_047E, B27001_048E, B27001_050E, B27001_051E, B27001_053E, B27001_054E, B27001_056E, B27001_057E)|>
  mutate(TotalInsuredMale = B27001_004E + B27001_007E + B27001_010E + B27001_013E + B27001_016E + B27001_019E + B27001_022E + B27001_025E + B27001_028E, 
         TotalUninsuredMale = B27001_005E + B27001_008E + B27001_011E + B27001_014E + B27001_017E + B27001_020E + B27001_023E + B27001_026E + B27001_029E, 
         TotalInsuredFemale = B27001_032E + B27001_035E + B27001_038E + B27001_041E + B27001_044E + B27001_047E + B27001_050E + B27001_053E + B27001_056E, 
         TotalUninsuredFemale = B27001_033E + B27001_036E + B27001_039E + B27001_042E + B27001_045E + B27001_048E + B27001_051E + B27001_054E + B27001_057E) |>
  select(GEOID, -B27001_004E, -B27001_005E, -B27001_007E, -B27001_008E, -B27001_010E, -B27001_011E, -B27001_013E, 
         -B27001_014E, -B27001_016E, -B27001_017E, -B27001_019E, -B27001_020E, -B27001_022E, -B27001_023E, -B27001_025E, -B27001_026E, -B27001_028E, -B27001_029E, -B27001_032E, -B27001_033E, -B27001_035E, -B27001_036E, -B27001_038E, -B27001_039E, -B27001_041E, -B27001_042E, -B27001_044E, -B27001_045E, -B27001_047E, -B27001_048E, -B27001_050E, -B27001_051E, -B27001_053E, -B27001_054E, -B27001_056E, -B27001_057E, TotalInsuredMale, TotalUninsuredMale, TotalInsuredFemale, TotalUninsuredFemale) 



census_final <- merge(census_table01, census_table11, by = "GEOID", all = TRUE)
census_final <- merge(census_final, census_table08, by = "GEOID", all = TRUE)
census_final <- merge(census_final, census_table04, by = "GEOID", all = TRUE)



# Rename columns for clarity
census_final <- census_final %>%
  rename(
    TotalAgeMale = B01001_002E,
    TotalAgeFemale = B01001_026E,
    TotalSexWorkMale = B23022_002E,
    TotalSexWorkFemale = B23022_026E,
    TotalPovertyMale = B17001_003E,
    TotalPovertyFemale = B17001_017E
    # Add more variable name changes as needed
  )


census_final

```

```{r}
county_name <- read_csv("~/tricomm/counties (1).csv", show_col_types = FALSE) 

census_county <- left_join(census_final, county_name, by = "GEOID")


census_summarized <- census_county |>
  group_by(County) |>
  summarize(
    TotalAgeMale = sum(TotalAgeMale),
    TotalAgeFemale = sum(TotalAgeFemale),
    TotalSexWorkMale = sum(TotalSexWorkMale),
    TotalSexWorkFemale = sum(TotalSexWorkFemale),
    TotalPovertyMale = sum(TotalPovertyMale),
    TotalPovertyFemale = sum(TotalPovertyFemale),
    TotalInsuredMale = sum(TotalInsuredMale),
    TotalUninsuredMale = sum(TotalUninsuredMale),
    TotalInsuredFemale = sum(TotalInsuredFemale),
    TotalUninsuredFemale = sum(TotalUninsuredFemale),
    Population = sum(TotalAgeMale + TotalAgeFemale)
  )

county_drug <- read_csv("~/tricomm/TriCoMM-Country-Prescriptions.csv", show_col_types = FALSE) 

census_summarized <- left_join(census_summarized, county_drug, by = "County")
census_summarized <- mutate(census_summarized, Prescriptions_Per_Population = Prescriptions / Population)

census_summarized

```

```{r}
cor(census_final$TotalPovertyMale, census_final$TotalUninsuredMale)
```

```{r}
ggplot(census_final, aes(x = TotalPovertyMale, y = TotalUninsuredMale)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  labs(title = " # of men in poverty per GEOID vs. # of men w/ no health insurance", x = "Poverty", y = "Insurance")

```

```{r}
# Load your pre-existing dataset
#your_dataset <- read.csv("~/tricomm/table01.csv")  # Replace with the actual path

# Define the number of iterations
num_iterations <- 1000

# Initialize a vector to store the results
results <- numeric(num_iterations)

# Run the Monte Carlo simulation
for (i in 1:num_iterations) {
  # Sample from your pre-existing dataset
  sample_row <- census_final[sample(nrow(census_final), 1), ]
 
  # Extract variables of interest
  variable1 <- sample_row$TotalAgeMale
  variable2 <- sample_row$TotalAgeFemale
 
  # Check if variables are missing or if they meet specific conditions
  if (!is.na(variable1) & !is.na(variable2)) {
    # Run your simulation or model with the sampled values
    result <- variable1 * variable2
   
    # Store the result
    results[i] <- result
  } else {
    # If variables are missing or don't meet conditions, retry the iteration
    i <- i - 1
  }
}

# Analyze the results
summary(results)
hist(results, main = "Monte Carlo Simulation Results", xlab = "Outcome")
```
